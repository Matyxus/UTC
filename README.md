<div id="top"></div>


<!-- PROJECT LOGO -->
<br />
<div align="center">
  <h3 align="center">Urban Traffic Control</h3>

  <p align="center">
    Bachelor thesis project: connecting automated planning with SUMO simulator
  </p>
</div>



<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#installation">Installation</a></li>
      </ul>
    </li>
    <li>
      <a href="#usafe">Usage</a>
    </li>
  </ol>
</details>



<!-- ABOUT THE PROJECT -->
## About The Project



Project description.

<p align="right">(<a href="#top">back to top</a>)</p>



### Built With

* [gcc]()
* [g++]()
* [python3.9]()
* [Cmake]() (for planner installation)
* [Make]() (for planner installation)

Python libraries: (version can be found in requirements.txt file)
* [pip](https://pypi.org/project/pip/)
* [wheel](https://pypi.org/project/wheel/)
* [setuptools](https://pypi.org/project/setuptools/)
* [numpy](https://numpy.org/)
* [matplotlib](https://matplotlib.org/)
* [prompt_toolkit](https://python-prompt-toolkit.readthedocs.io/en/master/)
* [traci](https://pypi.org/project/traci/)
* [sumolib](https://pypi.org/project/sumolib/)

<p align="right">(<a href="#top">back to top</a>)</p>



<!-- GETTING STARTED -->
## Getting Started

This is an example of how you may give instructions on setting up your project locally.
To get a local copy up and running follow these simple example steps.

### Prerequisites


1) [osmfilter.c](https://wiki.openstreetmap.org/wiki/Osmfilter) (located in UTC/utc/data/osm_filter) has to be compiled
  ```sh
  gcc osmfilter.c -O3 -o osmfilter
  ```
2) [SUMO](https://www.eclipse.org/sumo/) has to be downloaded
3) [Planners](https://ipc2018-classical.bitbucket.io/#description) 
used in this project: [MERWIN](https://bitbucket.org/ipc2018-classical/team14/src/ipc-2018-seq-agl/), 
[Cerberus](https://bitbucket.org/ipc2018-classical/team15/src/ipc-2018-seq-agl/) (agile)

### Installation

Below is an example of how you can instruct your audience on installing and setting up your app. This template doesn't rely on any external dependencies or services._

1. Clone the repo
   ```sh
   git clone https://github.com/Matyxus/UTC
   ```
2. In folder where UTC is located execute:
   ```sh
   pip install -e UTC
   ```
3. Install requirements (in ../UTC)
   ```sh
   pip install -r requirements.txt
   ```
4. Install planners
5. Give permission to project enabling it to create: folders, files and execute
commands with [subprocess](https://docs.python.org/3/library/subprocess.html) library.
6. Execute UTC/utc/test/test_launcher.py for testing the whole project

<p align="right">(<a href="#top">back to top</a>)</p>

<!-- Scenario -->
## Scenario
Scenarios consist of following files:
1. ".sumocfg" file (which will run the simulation in SUMO GUI)
2. ".rou.xml" file (contains vehicle types, routes, vehicles)
3. ".info" file (contains the commands used to generate scenario)
4. Optional files:  
   1. ".?" file (contains vehicle statistics), optional
   2. ".pddl" problem file (contains the scenario represented in pddl format)
   3. ".pddl" result file (contains the action of objects from pddl problem files, generated by planner)    

There are two types of scenarios:
1. user generated (created by using commands in "ScenarioLauncher" class)
2. planner generated (created by parsing pddl result files into new scenario)  
Scenarios structure is following (located in [data folder](./utc/data)):
   ```
   scenarios
      |
      └─── simulation (files related to simulation)
      │        │
      │        └─── generated ("[scenario].sumocfg" files generated by user)
      │        └─── planned ("[scenario].sumocfg" files generated by planner)
      │        └─── information ("[scenario].info" files)
      │        └─── statistics ("[scenario].?" statistics of scenarios)
      └─── routes ("[scenario].rou.xml" files)   
      └─── problems (".pddl" problem files, name of scenario as prefix in files)
      │       │
      │       └─── [scenario] (pddl problem generated from [scenario])
      └─── results (".pddl" results files, name of scenario as prefix in files)
      │       │
      │       └─── [scenario] (pddl result generated from [scenario])
   Note: [scenario] is name chosen by user (when generating
   planned scenario, new [scenario] name is inputted by user, all
   ".sumocfg" files must have unique names, 
   their names are referenced by corresponding files e.g. ".rou.xml" etc..)
   ```




<!-- USAGE EXAMPLES -->
## Usage

All "_launcher.py" files have class that is subclass of UserInterface (UTC/utc/src/ui), which uses
[prompt_toolkit](https://python-prompt-toolkit.readthedocs.io/en/master/) library to ask
user for input. Starting by asking for command name, and then command parameter\s (if there are any) will be written
in format: parameter_name1="", ..., parameter_nameX="default_vale", **all parameters that do not have default value
must be filled** (between "quotes"). Supports command/parameters history and validation, command name completion,
taking input from file (each line has to have at most 1 command and corresponding parameters separated by space
and in format described earlier),
then input can be redirected as such:
   ```sh
   python main.py < your_file
   ```
Base commands are **_help_** (which prints all commands, their parameters and their description) and **_exit_** which quits
the program.

1. Downloading maps from [OpenStreetMap](https://www.openstreetmap.org/). \
Save them in UTC/utc/data/maps/osm/original folder.
2. Convert downloaded maps into '.net.xml' format.
   ```sh
   python converter.py map_name1 map_name2 ...
   ```
   Or run converter.py and enter input dynamically, for command type 'convert',
   fill argument 'file_name' with name of the map.
   ```sh
   python converter.py
   ```
   ![converter example](Images/converter_input_example.PNG)
3. Generate scenario. \
Scenarios can be found in (UTC/utc/data/scenarios) and they consist of: 
   ```
   scenarios
      |
      └─── simulation ("[scenario].sumocfg", where scenario is name chosen by user)
      └─── routes ("[scenario].ruo.xml" files)   
      └─── statistics (folder containg statistics, same name as generated [scenario])
      └─── problems (".pddl" problem files, name of scenario as prefix in files)
      └─── results (".pddl" results files, name of scenario as prefix in files)
   ```
4. (Optional) Generate sub-graph for road network used in scenario. \
Planners can take long time to generate solutions if road network (or number of cars)
is high, for that reason road networks can be simplified (example below).
5. Call planner to generate plan for given scenario.
6. Launch scenario and compare vehicle statistics against planned simulation.

<p align="right">(<a href="#top">back to top</a>)</p>










